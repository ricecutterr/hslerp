{% extends 'admin/layout.html' %}
{% block title %}Celule Depozit - HSL ERP{% endblock %}
{% block content %}
<div class="page-header">
    <h2><i class="bi bi-grid-3x3 me-2"></i>Celule Depozit</h2>
</div>

<div class="bg-white rounded-3 p-3 mb-3" style="max-width:700px">
    <h6 class="fw-bold mb-3">AdaugÄƒ CelulÄƒ</h6>
    <div class="row g-2 align-items-end">
        <div class="col-md-2"><label class="form-label small">Cod *</label>
            <input id="cCod" class="form-control form-control-sm" placeholder="A-01-01"></div>
        <div class="col-md-2"><label class="form-label small">ZonÄƒ</label>
            <input id="cZona" class="form-control form-control-sm" placeholder="A"></div>
        <div class="col-md-2"><label class="form-label small">Raft</label>
            <input id="cRaft" class="form-control form-control-sm" placeholder="01"></div>
        <div class="col-md-2"><label class="form-label small">Nivel</label>
            <input id="cNivel" class="form-control form-control-sm" placeholder="01"></div>
        <div class="col-md-2"><label class="form-label small">Descriere</label>
            <input id="cDesc" class="form-control form-control-sm"></div>
        <div class="col-md-2">
            <button class="btn btn-hsl btn-sm w-100" onclick="addCelula()">+ AdaugÄƒ</button>
        </div>
    </div>
</div>

<div class="bg-white rounded-3 p-3">
{% if celule %}
<table class="table table-sm table-hover mb-0">
<thead><tr><th>Cod</th><th>Barcode</th><th>ZonÄƒ</th><th>Raft</th><th>Nivel</th><th>ConÈ›inut</th><th></th></tr></thead>
<tbody>
{% for c in celule %}
<tr>
    <td class="fw-bold">{{ c.cod }}</td>
    <td class="small text-muted">{{ c.barcode or c.cod }}</td>
    <td>{{ c.zona or '-' }}</td>
    <td>{{ c.raft or '-' }}</td>
    <td>{{ c.nivel or '-' }}</td>
    <td>
        {% set produse_celula = stoc_per_celula.get(c.id, []) %}
        {% if produse_celula %}
        {% for s in produse_celula %}
        <span class="badge bg-light text-dark me-1 mb-1"><strong>{{ s.cod_intern }}</strong>: {{ s.cantitate|int }}</span>
        {% endfor %}
        {% else %}<span class="text-muted small">GoalÄƒ</span>{% endif %}
    </td>
    <td><button class="btn btn-outline-danger btn-sm py-0 px-1" onclick="delCelula({{ c.id }})">ğŸ—‘ï¸</button></td>
</tr>
{% endfor %}
</tbody></table>
{% else %}<p class="text-muted text-center py-4">Nicio celulÄƒ definitÄƒ.</p>{% endif %}
</div>
{% endblock %}
{% block scripts %}<script>
function addCelula(){
    const cod=document.getElementById('cCod').value.trim();
    if(!cod)return alert('Cod obligatoriu!');
    fetch('/api/wms/celula',{method:'POST',headers:{'Content-Type':'application/json'},
        body:JSON.stringify({cod:cod,zona:document.getElementById('cZona').value.trim(),
            raft:document.getElementById('cRaft').value.trim(),
            nivel:document.getElementById('cNivel').value.trim(),
            descriere:document.getElementById('cDesc').value.trim(),
            barcode:cod})
    }).then(r=>r.json()).then(d=>{if(d.success)location.reload();else alert(d.error)});
}
function delCelula(id){if(!confirm('È˜terge celula?'))return;
    fetch('/api/wms/celula/'+id,{method:'DELETE'}).then(r=>r.json()).then(d=>{if(d.success)location.reload();else alert(d.error)});}
</script>{% endblock %}
