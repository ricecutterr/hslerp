{% extends 'admin/layout.html' %}
{% block title %}{{ 'Editare' if user else 'Utilizator Nou' }} - HSL ERP{% endblock %}
{% block content %}
<div class="page-header">
    <h2><i class="bi bi-person-gear me-2"></i>{{ 'Editare Utilizator' if user else 'Utilizator Nou' }}</h2>
</div>
<div class="bg-white rounded-3 p-4" style="max-width:600px">
<form method="POST">
    <div class="row g-3">
    <div class="col-md-6">
        <label class="form-label fw-bold">Username *</label>
        <input type="text" name="username" class="form-control" value="{{ user.username if user else '' }}" required>
    </div>
    <div class="col-md-6">
        <label class="form-label fw-bold">Nume Complet *</label>
        <input type="text" name="nume_complet" class="form-control" value="{{ user.nume_complet if user else '' }}" required>
    </div>
    <div class="col-md-6">
        <label class="form-label">Email</label>
        <input type="email" name="email" class="form-control" value="{{ user.email if user else '' }}">
    </div>
    <div class="col-md-4">
        <label class="form-label">Telefon</label>
        <input type="text" name="telefon" class="form-control" value="{{ user.telefon if user else '' }}">
    </div>
    <div class="col-md-2">
        <label class="form-label">Comision %</label>
        <input type="number" name="comision_procent" step="0.01" class="form-control" value="{{ user.comision_procent if user else '0.75' }}">
    </div>
    <div class="col-md-6">
        <label class="form-label fw-bold">Rol</label>
        <select name="rol_id" class="form-select">
            <option value="">-- Fără rol --</option>
            {% for r in roluri %}
            <option value="{{ r.id }}" {{ 'selected' if user and user.rol_id == r.id }}>
                {{ r.nume }}{% if r.is_system %} (sistem){% endif %}
            </option>
            {% endfor %}
        </select>
        <small class="text-muted"><a href="/admin/roluri">Gestionează roluri</a></small>
    </div>
    <div class="col-md-6">
        <label class="form-label fw-bold">Parolă {% if user %}(lasă gol pt a nu schimba){% endif %}</label>
        <input type="password" name="password" class="form-control" {{ '' if user else 'required' }} placeholder="{{ '••••••••' if user else '' }}">
    </div>
    <div class="col-12">
        <div class="form-check">
            <input type="checkbox" name="activ" class="form-check-input" {{ 'checked' if not user or user.activ }}>
            <label class="form-check-label">Cont Activ</label>
        </div>
    </div>
    </div>

    {% if user and user.rol_obj %}
    <div class="mt-3 p-3 rounded" style="background:#f8f9fa">
        <small class="text-muted">
            <strong>Rol:</strong> {{ user.rol_obj.nume }} ·
            <strong>Vizibilitate:</strong> {{ 'Doar proprii' if user.rol_obj.doar_proprii else 'Toate documentele' }} ·
            <strong>Creat:</strong> {{ user.data_creare.strftime('%d.%m.%Y %H:%M') if user.data_creare else '-' }}
        </small>
    </div>
    {% endif %}

    <div class="mt-4">
        <button class="btn btn-hsl me-2"><i class="bi bi-check-lg me-1"></i>{{ 'Salvează' if user else 'Creează Utilizator' }}</button>
        <a href="/admin/utilizatori" class="btn btn-outline-secondary">Anulează</a>
    </div>
</form>
</div>
{% endblock %}
