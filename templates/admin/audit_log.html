{% extends 'admin/layout.html' %}
{% block title %}Audit Log - HSL ERP{% endblock %}
{% block content %}
<div class="page-header d-flex justify-content-between align-items-center">
    <h2><i class="bi bi-clock-history me-2"></i>Audit Log</h2>
    <div class="btn-group btn-group-sm">
        <a href="/admin/audit-log" class="btn btn-{% if not filter_tip %}hsl{% else %}outline-secondary{% endif %}">Toate</a>
        <a href="/admin/audit-log?tip=oferta" class="btn btn-{% if filter_tip=='oferta' %}hsl{% else %}outline-secondary{% endif %}">Oferte</a>
        <a href="/admin/audit-log?tip=comanda" class="btn btn-{% if filter_tip=='comanda' %}hsl{% else %}outline-secondary{% endif %}">Comenzi</a>
        <a href="/admin/audit-log?tip=nir" class="btn btn-{% if filter_tip=='nir' %}hsl{% else %}outline-secondary{% endif %}">NIR</a>
        <a href="/admin/audit-log?tip=picking" class="btn btn-{% if filter_tip=='picking' %}hsl{% else %}outline-secondary{% endif %}">Picking</a>
    </div>
</div>

<div class="bg-white rounded-3 p-3">
{% if entries %}
<table class="table table-hsl table-hover mb-0">
<thead><tr><th style="width:130px">Data</th><th>Document</th><th>Acțiune</th><th>Detalii</th><th>Utilizator</th></tr></thead>
<tbody>
{% for e in entries %}
{% set type_icons = {'oferta':'bi-file-text text-warning','comanda':'bi-cart text-success','nir':'bi-clipboard-data text-info','picking':'bi-cart-check text-primary','factura':'bi-receipt text-danger'} %}
{% set action_colors = {'creat':'success','status_schimbat':'warning','confirmat_scriptic':'info','picking_generat':'primary','livrata':'success','convertit':'primary','sters':'danger'} %}
<tr>
    <td class="small text-muted">{{ e.data.strftime('%d.%m.%Y %H:%M') }}</td>
    <td>
        <i class="bi {{ type_icons.get(e.tip_document, 'bi-file') }} me-1"></i>
        <strong>{{ e.document_numar or e.tip_document }}</strong>
        <span class="badge bg-light text-muted" style="font-size:.6rem">{{ e.tip_document }}</span>
    </td>
    <td><span class="badge bg-{{ action_colors.get(e.actiune, 'secondary') }}">{{ e.actiune|replace('_',' ')|title }}</span></td>
    <td class="small">{{ e.detalii or '' }}</td>
    <td class="small">{{ e.utilizator.nume_complet if e.utilizator else '?' }}</td>
</tr>
{% endfor %}
</tbody></table>
{% else %}
<p class="text-center text-muted py-4">Nicio intrare în log.</p>
{% endif %}
</div>
{% endblock %}
